// Generated by CoffeeScript 1.12.4
var rcCategorias, rcClientIndex, rcClientes, rcEspecificacion, rcEstadisticas, rcOrdenes, rcProductos, rcProfile, rcReportes, rcSectores, rcUsuarios, rcPersonaUsuario, rcLoginCliente,registroCliente,rcCompra,clienteDireccion,finalizarCompra,estadoUsuario;

rcClientes = function($resource) {
  return $resource('/admin/clientes', {}, {
    get: {
      url: '/admin/get-clientes',
      method: 'post',
      isArray: false
    }
  });
};

rcEstadisticas = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-estadisticas',
      method: 'post',
      isArray: false
    }
  });
};

rcOrdenes = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-ordenes',
      method: 'post',
      isArray: false
    },
    statusChange: {
      url: '/admin/ordenes-status-change',
      method: 'post',
      isArray: false
    }
  });
};

rcReportes = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-reportes',
      method: 'post',
      isArray: false
    }
  });
};

rcCategorias = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-categorias',
      method: 'post',
      isArray: false
    },
    statusChange: {
      url: '/admin/categorias-status-change',
      method: 'post',
      isArray: false
    },
    edit: {
      url: '/admin/categorias-edit',
      method: 'post',
      isArray: false
    }
  });
};

rcProductos = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-productos',
      method: 'post',
      isArray: false
    },
    statusChange: {
      url: '/admin/productos-status-change',
      method: 'post',
      isArray: false
    },
    edit: {
      url: '/admin/productos-edit',
      method: 'post',
      isArray: false
    }
  });
};

rcEspecificacion = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-especificacion',
      method: 'post',
      isArray: false
    },
    statusChange: {
      url: '/admin/especificacion-status-change',
      method: 'post',
      isArray: false
    },
    edit: {
      url: '/admin/especificacion-edit',
      method: 'post',
      isArray: false
    }
  });
};

rcSectores = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-sectores',
      method: 'post',
      isArray: false
    },
    statusChange: {
      url: '/admin/sectores-status-change',
      method: 'post',
      isArray: false
    },
    edit: {
      url: '/admin/sectores-edit',
      method: 'post',
      isArray: false
    }
  });
};

rcUsuarios = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-usuarios',
      method: 'post',
      isArray: false
    }
  });
};

rcProfile = function($resource) {
  return $resource('', {}, {
    get: {
      url: '/admin/get-profile',
      method: 'post',
      isArray: false
    }
  });
};

rcClientIndex = function($resource) {
  return $resource('', {}, {
    getCategorias: {
      url: '/index/get-categorias',
      method: 'get',
      isArray: false
    },
    getProductos: {
      url: '/index/get-productos',
      method: 'get',
      isArray: false
    },
    getSectores: {
      url: '/index/get-sectores',
      method: 'get',
      isArray: false
    },
    getEspecificaciones: {
      url: '/index/get-especificaciones',
      method: 'get',
      isArray: false
    }
  });
};

rcPersonaUsuario = function($resource) {
  return $resource('', {}, {
    getDataUsuario: {
      url: '/index/get-data-usuario',
      method: 'post',
      isArray: false
    },
    edit: {
      url: '/index/persona-edit',
      method: 'post',
      isArray: false
    },
    registrar: {
      url: '/index/registrar-cliente',
      method: 'post',
      isArray: false
    },
    crearDireccion: {
      url: '/index/crear-direccion',
      method: 'post',
      isArray: false
    },
    eliminarDireccion: {
      url: '/index/eliminar-direccion',
      method: 'post',
      isArray: false
    }
  });
};

servicio = function(rcPersonaUsuario) {
  var ret = function(){}
  ret.itemsCarro = JSON.parse(localStorage.getItem("itemsCarro")); 
  ret.nElementsCarro = localStorage.getItem("nElementsCarro");
  ret.loginEmail = "";
  ret.loginPassword = "";
  ret.rcPersonaUsuario = rcPersonaUsuario;

  ret.restarElementosEliminados = function(numero){
    ret.nElementsCarro = ret.nElementsCarro - numero;
  }
  ret.anadirElemento = function(nuevoElemento){
    ret.listaCompartida.push(nuevoElemento);
  }
  ret.limpiarLista = function(){
    ret.listaCompartida = [];
  }
  ret.submitLoginForm = function() {

    return rcPersonaUsuario.getDataUsuario({
      correo: ret.loginEmail,
      password: ret.loginPassword 
    }, function(r) {
      if (r.success === true) {
        //return modal(r);
        
      } else {
        //return Msg.Info("Sin datos");
        
      }
    }, function(error) {
      return Msg.Error();
    });
  };



  return ret;
};

rcLoginCliente = function(rcPersonaUsuario,registroCliente,$modal) {
  var login = function(){}
  login.loginEmail = "";
  login.loginPassword = "";
  login.rcPersonaUsuario = rcPersonaUsuario;
  login.registroCliente = registroCliente;

  login.submitLoginForm = function() {
    return rcPersonaUsuario.getDataUsuario({
      correo: login.loginEmail,
      password: login.loginPassword 
    }, function(r) {
      if (r.success === true) {
        localStorage.setItem("usuarioCliente", JSON.stringify(r.data));
        //return $modalInstance.dismiss('cancel');
        //return modal(r);
        
      } else {
        //return Msg.Info("Sin datos");
        
      }
    }, function(error) {
      return Msg.Error();
    });
  };

  login.enviarPedido = function(responce) {
    if( !localStorage.userCliente ) {      
      var modalInstance;
      return modalInstance = $modal.open({
        templateUrl: 'formLoginCliente.html',
        controller: 'ModalInstanceCrtl',
        windowClass: 'app-modal-window',
        //size: "md",
        backdrop: 'static',
        resolve: {
          data: function() {
            return {
              resumen: "Algo debe hacerse. Llamar a un servicio o algo que haga el guardado"
            };
          }
        }
      }).result.then(function(resultado) {}, function(close) {});
     
    } else {
      alert("Ya estÃ¡ logueado");
    }
    if (responce == null) {
      responce = true;
    }
    return $modalInstance.close(responce);
  };

  login.limpiar = function() {
    login.loginEmail = "";
    login.loginPassword = "";
    return true;
  };
  return login;
};

registroCliente = function(rcPersonaUsuario, rcClientIndex, Msg, estadoUsuario) {
  var registro = function(){}
  registro.rEmail = "";
  registro.rPassword = "";
  registro.rNombres = "";
  registro.rApellidos = "";
  registro.rTelefono = "";
  registro.rSector = "";
  registro.rDirCalle = "";
  registro.rDirNumero = "";
  registro.rDirDetalle = "";
  registro.paso = 1;

  registro.estadoUsuario = estadoUsuario;

  registro.rcPersonaUsuario = rcPersonaUsuario;
  registro.rcClientIndex = rcClientIndex;
  registro.response = rcClientIndex.getSectores();
  registro.sectores = [];
  
  registro.getSectores = function() {
    return rcClientIndex.getSectores({}, function(r) {
      return registro.sectores = r.data;
    });
  };

  registro.limpiar = function() {
    registro.rEmail = "";
    registro.rPassword = "";
    registro.rNombres = "";
    registro.rApellidos = "";
    registro.rTelefono = "";
    registro.rSector = "";
    registro.rDirCalle = "";
    registro.rDirNumero = "";
    registro.rDirDetalle = "";
    registro.paso = 1;
  };
  registro.getSectores();
  return registro;
};

rcCarrito = function() {
  var carrito = function(){}
  carrito.itemsCarro = JSON.parse(localStorage.getItem("itemsCarro")); 
  carrito.nElementsCarro = localStorage.getItem("nElementsCarro");  
  carrito.precioTotal = localStorage.getItem("precioTotal");
  carrito.restarElementosEliminados = function(numero){
    carrito.nElementsCarro = carrito.nElementsCarro - numero;
  }
  carrito.anadirElemento = function(nuevoElemento){
    carrito.listaCompartida.push(nuevoElemento);
  }

  carrito.sumarItem = function (idItem) {
    var productos_carro = JSON.parse(localStorage.getItem("itemsCarro"));
    var cantidad =  parseInt(productos_carro[idItem].cantidad);
    var nElementsCarro =  parseInt(localStorage.nElementsCarro);
    var monto_total = parseInt(localStorage.precioTotal);
    productos_carro[idItem].cantidad = cantidad + 1;
    nuevo_monto = productos_carro[idItem].valor + productos_carro[idItem].precioEspecificacion;
    productos_carro[idItem].cantidad = cantidad + 1;
    var nFinal = nElementsCarro + 1;
    localStorage.setItem("itemsCarro", JSON.stringify(productos_carro));
    carrito.itemsCarro = JSON.parse(localStorage.getItem("itemsCarro")); 
    localStorage.nElementsCarro = nFinal;
    localStorage.precioTotal = parseInt(monto_total) + parseInt(nuevo_monto);
    carrito.precioTotal = parseInt(monto_total) + parseInt(nuevo_monto);
    carrito.nElementsCarro = nFinal;
  };

  carrito.restarItem = function (idItem) {
    var productos_carro = JSON.parse(localStorage.getItem("itemsCarro"));
    var cantidad =  parseInt(productos_carro[idItem].cantidad);
    var monto_total = parseInt(localStorage.precioTotal);
    if( cantidad > 1 ) {
      var nElementsCarro =  parseInt(localStorage.nElementsCarro);
      productos_carro[idItem].cantidad = cantidad - 1;
      //productos_carro[idItem].cantidad = cantidad - 1;
      var nFinal = nElementsCarro - 1;
      nuevo_monto = productos_carro[idItem].valor + productos_carro[idItem].precioEspecificacion;
      localStorage.setItem("itemsCarro", JSON.stringify(productos_carro));
      carrito.itemsCarro = JSON.parse(localStorage.getItem("itemsCarro")); 
      localStorage.nElementsCarro = nFinal;
      localStorage.precioTotal = parseInt(monto_total) - parseInt(nuevo_monto);
      carrito.precioTotal = parseInt(monto_total) - parseInt(nuevo_monto);
      carrito.nElementsCarro = nFinal;
    }
  };

  carrito.eliminarItem = function (idItem) {
    var productos_carro = JSON.parse(localStorage.getItem("itemsCarro"));
    var cantidad = productos_carro[idItem].cantidad; 
    var nElementsCarro = localStorage.nElementsCarro;
    var monto_total = parseInt(localStorage.precioTotal);
    var monto_item = parseInt(productos_carro[idItem].valor) * cantidad + parseInt(productos_carro[idItem].precioEspecificacion) * cantidad;
    delete(productos_carro[idItem]);
    var nFinal = nElementsCarro - cantidad;
    localStorage.precioTotal = parseInt(monto_total) - parseInt(monto_item);
    carrito.precioTotal = parseInt(monto_total) - parseInt(monto_item);
    localStorage.setItem("itemsCarro", JSON.stringify(productos_carro));
    carrito.itemsCarro = JSON.parse(localStorage.getItem("itemsCarro")); 
    localStorage.nElementsCarro = nFinal;
    carrito.nElementsCarro = nFinal;
  };

  return carrito;
};

clienteDireccion = function() {
  var direccion = function(){}

  direccion.dirSector = "";
  direccion.dirCalle = "";
  direccion.dirNumero = "";
  direccion.dirDetalle = "";
  
  direccion.limpiar = function(numero) {
    direccion.nElementsCarro = direccion.nElementsCarro - numero;
    direccion.dirSector = "";
    direccion.dirCalle = "";
    direccion.dirNumero = "";
    direccion.dirDetalle = "";
  }
  
  return direccion;
};

confirmarEnvio = function(rcPersonaUsuario, rcClientIndex, Msg) {
  var registro = function(){}

  registro.rcPersonaUsuario = rcPersonaUsuario;
  registro.rcClientIndex = rcClientIndex;
  registro.response = rcClientIndex.getSectores();
  registro.sectores = [];
  
  registro.submitRegistroForm = function() {
    return rcPersonaUsuario.registrar({
      correo: registro.rEmail,
      password: registro.rPassword,
      nombres:registro.rNombres,
      apellidos:registro.rApellidos,
      telefono:registro.rTelefono,
      sector:registro.rSector,
      dir_calle:registro.rDirCalle,
      dir_numero:registro.rDirNumero,
      dir_detalle:registro.rDirDetalle
    }, function(r) {
      if (r.success === true) {
        localStorage.setItem("usuarioCliente", JSON.stringify(r.data));
        return Msg.Success(r.mensaje);
      } else {
        return Msg.Info(r.mensaje);
      }
    }, function(error) {
      return Msg.Error();
    });
  };
  registro.getSectores = function() {
    return rcClientIndex.getSectores({}, function(r) {
      return registro.sectores = r.data;
    });
  };
  registro.getSectores();
  return registro;
};

rcCompra = function($resource) {
  return $resource('', {}, {
    getCompras: {
      url: '/index/get-compras',
      method: 'post',
      isArray: false
    },
    ingresar: {
      url: '/index/ingresar-compra',
      method: 'post',
      isArray: false
    }
  });
};

finalizarCompra = function(rcCompra, Msg){
  var compra = function(){}
  compra.dirSel = "";
  compra.idDireccion = "";
  compra.cSector = "";
  compra.cDirCalle = "";
  compra.cDirNumero = "";
  compra.cDirDetalle = "";
  compra.opcNuevaDireccion = 0;
  compra.rcCompra = rcCompra;
  compra.sectores = [];
  compra.objRespuesta = {};
  compra.submitCompra = function(data) {
    compra.objRespuesta = JSON.stringify(data);
    return rcCompra.ingresar({
      id_direccion: compra.idDireccion,
      data:compra.objRespuesta,
      opc_nueva:compra.opcNuevaDireccion,
      //dir_calle:compra.rDirCalle,
      //dir_numero:compra.rDirNumero,
      //dir_detalle:compra.rDirDetalle
    }, function(r) {
      if (r.success === true) {
        
        //localStorage.setItem("usuarioCliente", JSON.stringify(r.data));
        return Msg.Success(r.mensaje);
      } else {
        
        return Msg.Info(r.mensaje);
      }
    }, function(error) {
      
      return Msg.Error();
    });
  };

  compra.seleccionarDireccion = function(id) {
    compra.dirSel = id;
    return true;
  };

   return compra;
}

estadoUsuario = function() {
  var estado = function(){}
  estado.nombreUsuario = "";
  estado.usuario = false;
  if( localStorage.getItem("usuarioCliente") ) {
    var data_perfil = JSON.parse(localStorage.getItem("usuarioCliente"));
    estado.usuario = true;
    estado.nombreUsuario = data_perfil.nombre;
  }
  return estado;
}

